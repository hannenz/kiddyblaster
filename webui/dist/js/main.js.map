{"version":3,"sources":["file_select.js","main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["var FileSelect = function() {\n\n\tvar uriInput = document.querySelector('[name=uri]');\n\tvar uriGhostInput = document.querySelector('[name=uri-ghost]');\n\tvar dlg = document.getElementById('file-select-dialog');\n\tvar fileList = document.getElementById('file-list');\n\n\turiInput.addEventListener('focus', function() {\n\t\turiGhostInput.value = uriInput.value;\n\t\tdlg.hidden = false;\n\t\tdocument.addEventListener('keyup', onKeyUp);\n\t\tloadDir(this.value);\n\t});\n\n\n\tfunction onKeyUp(ev) {\n\t\tif (ev.keyCode == 27) {\n\t\t\tcloseDialog();\n\t\t}\n\t}\n\n\n\tfunction closeDialog() {\n\t\tdlg.hidden = true;\n\t\tdocument.removeEventListener('keyup', onKeyUp);\n\t}\n\n\n\tfunction loadDir(path) {\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', '/dir/get/' + encodeURIComponent(path));\n\t\txhr.onload = function() {\n\t\t\tfileList.innerHTML = '';\n\t\t\tvar result = JSON.parse(this.responseText);\n\n\t\t\tvar closeBtn = document.getElementById('file-select-dialog-close-btn');\n\t\t\tcloseBtn.addEventListener('click', function() {\n\t\t\t\tcloseDialog();\n\t\t\t});\n\t\t\tvar applyBtn = document.getElementById('file-select-dialog-apply-btn');\n\t\t\tapplyBtn.addEventListener('click', function() {\n\t\t\t\turiInput.value = uriGhostInput.value;\n\t\t\t\tcloseDialog();\n\t\t\t});\n\n\t\t\tif (uriGhostInput.value.length > 0) {\n\t\t\t\tvar parentListItem = document.createElement('li');\n\t\t\t\tvar parentLink = document.createElement('a');\n\t\t\t\tparentLink.innerText = '..';\n\t\t\t\tparentLink.setAttribute('href', 'javascript:;');\n\t\t\t\tparentLink.className = 'go-up';\n\t\t\t\tparentLink.addEventListener('click', onParentLinkClicked);\n\t\t\t\tparentListItem.appendChild(parentLink);\n\t\t\t\tfileList.appendChild(parentListItem);\n\t\t\t}\n\n\t\t\tresult.forEach(function(item) {\n\t\t\t\tif (item.name.indexOf('.') != 0) {\n\n\t\t\t\t\tvar listItem = document.createElement('li');\n\t\t\t\t\tvar link = document.createElement('a');\n\t\t\t\t\tlink.innerText = item.name;\n\t\t\t\t\tlink.className = item.isDir ? 'dir' : 'file';\n\t\t\t\t\tif (item.isDir) {\n\t\t\t\t\t\tlink.setAttribute('href', 'javascript:;');\n\t\t\t\t\t\tlink.addEventListener('click', onFileSelectFileClicked);\n\t\t\t\t\t}\n\t\t\t\t\tlistItem.appendChild(link);\n\t\t\t\t\tfileList.appendChild(listItem);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\txhr.send();\n\t}\n\n\tfunction onFileSelectFileClicked() {\n\t\tif (uriGhostInput.value.length == 0) {\n\t\t\turiGhostInput.value = this.innerText;\n\t\t}\n\t\telse {\n\t\t\turiGhostInput.value = uriGhostInput.value + '/' + this.innerText;\n\t\t}\n\t\tloadDir(uriGhostInput.value);\n\t}\n\n\tfunction onParentLinkClicked() {\n\t\tvar matches = uriGhostInput.value.match(/(.*)\\//);\n\t\turiGhostInput.value = (matches != null)  ? matches[1] : '';\n\t\tloadDir(uriGhostInput.value);\n\t}\n\n};\n","var KiddyBlaster = function() {\n\n\tvar self = this;\n\n\tthis.init = function() {\n\t\tconsole.log(\"init\");\n\t\tself.initButtons();\n\t\tvar fileSelect = new FileSelect();\n\t};\n\n\tthis.initButtons = function() {\n\n\t\tvar deleteButtons = document.querySelectorAll('.delete');\n\t\tdeleteButtons.forEach(function(btn) {\n\t\t\tbtn.addEventListener('click', function(ev) {\n\t\t\t\tev.preventDefault();\n\n\t\t\t\tvar id = btn.dataset.id;\n\t\t\t\tif (!confirm(\"Soll die Karte mit der ID \" + id + \" wirklich gel√∂scht werden?\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar req = new XMLHttpRequest();\n\t\t\t\treq.open('GET', '/cards/delete/' + id);\n\t\t\t\treq.onload = function(ev) {\n\t\t\t\t\tif (req.status < 200 || req.status >= 400) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar frag = new DocumentFragment();\n\t\t\t\t\tvar temp = document.createElement('div');\n\t\t\t\t\ttemp.innerHTML = req.responseText;\n\t\t\t\t\twhile(temp.firstChild) {\n\t\t\t\t\t\tfrag.appendChild(temp.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar newList = frag.querySelector('.cards');\n\t\t\t\t\tconsole.log(newList);\n\t\t\t\t\tvar list = document.querySelector('.cards');\n\t\t\t\t\tconsole.log(list);\n\n\t\t\t\t\tvar parent = list.parentNode;\n\t\t\t\t\tparent.insertBefore(newList, list);\n\t\t\t\t\tparent.removeChild(list);\n\t\t\t\t};\n\n\t\t\t\treq.send();\n\t\t\t});\n\t\t});\n\t};\n};\n\ndocument.addEventListener('DOMContentLoaded', function() {\n\tconsole.log(\"DOMContentLoaded\");\n\tvar kiddyBlaster = new KiddyBlaster();\n\tkiddyBlaster.init();\n});\n"]}